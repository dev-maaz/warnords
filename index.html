<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    class Example extends Phaser.Scene {
        preload() {
    
            this.load.image('mech1', 'assets/AA First Mech.png');
            this.load.image('mech2', 'assets/Jupiter.png');
            this.load.image('mech3', 'assets/Scorpio.png');
            this.load.image('enemy', 'assets/SpaceMarines.png');

        }

        create() {

            this.LANE_COUNT = 5;
            this.LANE_HEIGHT = this.game.config.height / this.LANE_COUNT;
            this.currentLane = 0;

            this.selector = this.add.rectangle(
                this.game.config.width / 2 - this.game.config.width / 4,
                this.LANE_HEIGHT / 2,
                this.game.config.width /2,
                this.LANE_HEIGHT,
                0xFFFF00,
                0.3
            );


            this.playerUnits = this.physics.add.group({
                runChildUpdate: true
            });

            this.cursors = this.input.keyboard.createCursorKeys();
            this.spaceBar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

            this.input.keyboard.on('keydown-LEFT', this.selectPreviousUnit, this);
            this.input.keyboard.on('keydown-RIGHT', this.selectNextUnit, this);

            // this.input.keyboard.on('key_UP', this.moveSelectorUp, this);
            // this.input.keyboard.on('key_DOWN', this.moveSelectorDown, this);
            // this.spaceBar.on('down', this.spawnUnit, this);

            this.unitTypes = ['mech1', 'mech2', 'mech3'];
            this.currentUnitIndex = 0;

            this.selectCursor = this.add.rectangle(
                30,
                30,
                30,
                5,
                0xffffff,
                0.3
            )

            this.add.image(10, 30, this.unitTypes[0]);
            this.add.image(60, 30, this.unitTypes[1]);
            this.add.image(110, 30, this.unitTypes[2]);
            this.selectedUnitDisplay = this.add.image(10, 40, this.unitTypes[this.currentUnitIndex]);
            this.selectedUnitDisplay.setOrigin(0, 0);
            this.selectedUnitDisplay.setScale(0.75);
        }

        update() {

            this.playerUnits.children.entries.forEach((unit) => {
                unit.x += 3; 
                if (unit.x > this.game.config.width) {
                    unit.destroy();
                }
            });

            if (Phaser.Input.Keyboard.JustDown(this.cursors.up)) {
            this.moveSelectorUp();
            } else if (Phaser.Input.Keyboard.JustDown(this.cursors.down)) {
                this.moveSelectorDown();
            }

            if (Phaser.Input.Keyboard.JustDown(this.spaceBar)) {
                this.spawnUnit();
            }
        }

        // PLAYER 1 CONTROLS
        moveSelectorUp() {
            if (this.currentLane > 0) {
                this.currentLane--;
                this.updateSelectorPosition();
            }
        }

        moveSelectorDown() {
            if (this.currentLane < this.LANE_COUNT - 1) {
                this.currentLane++;
                this.updateSelectorPosition();
            }
        }

        updateSelectorPosition() {
            this.selector.y = this.currentLane * this.LANE_HEIGHT + this.LANE_HEIGHT / 2;
        }

        spawnUnit() {
            const unitY = this.currentLane * this.LANE_HEIGHT + this.LANE_HEIGHT / 2;
            const unit = this.physics.add.sprite(0, unitY, this.unitTypes[this.currentUnitIndex]);

            unit.setScale(1);
            unit.setOrigin(0, 0.5);
            
            unit.body.setAllowGravity(false);
            
            this.playerUnits.add(unit);
        }

        selectPreviousUnit() {
            this.currentUnitIndex = (this.currentUnitIndex - 1 + this.unitTypes.length) % this.unitTypes.length;
            if(this.selectCursor.x >= 60)this.selectCursor.x = this.selectCursor.x - 50;
            this.updateSelectedUnitDisplay();
        }

        selectNextUnit() {
            this.currentUnitIndex = (this.currentUnitIndex + 1) % this.unitTypes.length;
            if(this.selectCursor.x <= 60)this.selectCursor.x = this.selectCursor.x + 50;
            this.updateSelectedUnitDisplay();
        }

        updateSelectedUnitDisplay() {
            this.selectedUnitDisplay.setTexture(this.unitTypes[this.currentUnitIndex]);
        }

        //PLAYER 2 CONTROLS
    }

    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        scene: Example,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 0 } 
            }
        }
    };

    const game = new Phaser.Game(config);
    </script>

</body>
</html>
